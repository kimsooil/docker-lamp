# https://cookiecutter-django.readthedocs.io/en/latest/developing-locally-docker.html#

version: '3'

volumes:
    pgdata:
    
services:
    mailhog:
        image: mailhog/mailhog
        restart: unless-stopped
        ports:
            - "127.0.0.1:8025:8025"

    postgresdb:
        image: postgres:9.6-alpine
        environment:
            - POSTGRES_DB
            - POSTGRES_USER
            - POSTGRES_PASSWORD
        restart: unless-stopped
        volumes:
            - pgdata:/var/lib/postgresql/data
        ports:
            - "127.0.0.1:5432:5432"
        # # build: ./docker_postgres
        # # image: postgresql_database:latest
        # image: postgres:9.6-alpine
        # restart: always
        # ports: # IMPORTANT: Make sure to use 127.0.0.1 to keep it local. Otherwise, this will be broadcast to the web.
        #     - 127.0.0.1:5432:5432
        # environment:
        #     - POSTGRES_DB
        #     - POSTGRES_USER
        #     - POSTGRES_PASSWORD
        # volumes: # <- important!  the `/var/lib/postgresql/data` mounting point for your container is where postgresql's default data location is!
        #     - postgres_data:/var/lib/postgresql/data
    web:
        build: .
        image: django_web:latest
        volumes:
            - .:/app/
        ports: # IMPORTANT: Make sure to use 127.0.0.1 to keep it local. Otherwise, this will be broadcast to the web.
            - 127.0.0.1:8000:8000
        depends_on:
            - postgresdb
            - mailhog
        environment: # NOTE: Without
            - POSTGRES_DB
            - POSTGRES_USER
            - POSTGRES_PASSWORD
            - DJANGO_SETTINGS_MODULE
            - ENVIRONMENT
            - SECRET_KEY
            - DJANGO_ALLOWED_HOSTS
            - DJANGO_EMAIL_HOST="mailhog"
            - DJANGO_EMAIL_PORT=1025
            - DJANGO_EMAIL_BACKEND="django.core.mail.backends.smtp.EmailBackend"
        links:
            - "postgresdb"