version: '3'

volumes:
    postgres_data:
    
services:
    db:
        build: docker_postgres/.
        image: postgresql_database:latest
        ports: # IMPORTANT: Make sure to use 127.0.0.1 to keep it local. Otherwise, this will be broadcast to the web.
            - 127.0.0.1:5432:5432
        environment:
            - DATABASE_USER
            - DATABASE_PASSWORD
            - DATABASE_NAME
        volumes: # <- important!  the `/var/lib/postgresql/data` mounting point for your container is where postgresql's default data location is!
            - postgres_data:/var/lib/postgresql/data
    web:
        build: .
        image: django_web:latest
        volumes:
            - .:/svr/
        ports: # IMPORTANT: Make sure to use 127.0.0.1 to keep it local. Otherwise, this will be broadcast to the web.
            - 127.0.0.1:8000:8000
        depends_on:
            - db
        environment: # NOTE: Without 
            - DJANGO_SETTINGS_MODULE
        links:
            - "db"